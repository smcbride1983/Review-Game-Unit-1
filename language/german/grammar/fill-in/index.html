<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fill-in-the-Blank (Dark Mode)</title>

  <style>
    :root{
      color-scheme: dark;
      --bg:#0b1220;
      --panel:#0f1a2d;
      --panel2:#0c1628;
      --text:#e8eefc;
      --muted:#9bb0d6;
      --border:rgba(255,255,255,.10);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --accent:#7aa2ff;
      --good:#38d67a;
      --bad:#ff5c78;
      --warn:#ffd36e;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, rgba(122,162,255,.16), transparent 60%),
                  radial-gradient(900px 500px at 90% 20%, rgba(56,214,122,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{ color:inherit; }

    .wrap{ max-width: 980px; margin: 0 auto; padding: 16px; }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    /* Top bar */
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding: 14px 14px;
      background: rgba(15,26,45,.80);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
    }
    .left, .right{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .brand{
      display:flex; flex-direction:column; line-height:1.1;
      padding-right: 4px;
    }
    .brand .title{ font-size: 16px; font-weight: 800; letter-spacing:.2px; }
    .brand .sub{ font-size: 12px; color: var(--muted); }

    label.small{ font-size: 12px; color: var(--muted); }
    select, input[type="text"]{
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
    }
    select{ padding-right: 34px; }

    .btn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 650;
      cursor: pointer;
      display:inline-flex; align-items:center; gap:8px;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.07); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: rgba(122,162,255,.16);
      border-color: rgba(122,162,255,.45);
    }
    .btn.good{
      background: rgba(56,214,122,.14);
      border-color: rgba(56,214,122,.45);
    }
    .btn.ghost{
      background: transparent;
    }

    /* Content */
    .content{ padding: 16px; }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    .panel{
      background: rgba(12,22,40,.65);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
    }
    .panel h2{
      margin:0 0 10px;
      font-size: 14px;
      color: var(--muted);
      font-weight: 800;
      letter-spacing: .2px;
      text-transform: uppercase;
    }

    .sentence{
      font-size: 22px;
      line-height: 1.5;
      font-weight: 700;
      margin: 0 0 12px;
    }
    .blank{
      display:inline-block;
      min-width: 150px;
      padding: 2px 10px 4px;
      margin: 0 4px;
      border-bottom: 2px dashed rgba(122,162,255,.7);
      color: var(--accent);
      text-align:center;
    }

    .hint{
      font-size: 13px;
      color: var(--muted);
      margin: 8px 0 0;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .row.tight{ gap:8px; }

    .statusbar{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; flex-wrap:wrap;
      padding: 12px 14px;
      border-top: 1px solid var(--border);
      background: rgba(15,26,45,.55);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      font-size: 13px;
      color: var(--muted);
    }
    .pill strong{ color: var(--text); }

    .feedback{
      margin-top: 10px;
      font-size: 14px;
      font-weight: 700;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
    }
    .feedback.good{ border-color: rgba(56,214,122,.5); background: rgba(56,214,122,.10); color: #bff3d3; }
    .feedback.bad{ border-color: rgba(255,92,120,.5); background: rgba(255,92,120,.10); color: #ffd0d8; }

    /* Tutorial modal */
    .modalBackdrop{
      position: fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center; justify-content:center;
      padding: 18px;
      z-index: 999;
    }
    .modal{
      width: min(720px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHeader{
      display:flex; justify-content:space-between; align-items:center;
      padding: 14px 14px;
      border-bottom: 1px solid var(--border);
      background: rgba(15,26,45,.85);
    }
    .modalHeader h3{
      margin:0;
      font-size: 15px;
      letter-spacing:.2px;
    }
    .modalBody{ padding: 14px; color: var(--text); }
    .modalBody p{ margin: 0 0 10px; color: var(--muted); }
    .modalBody ul{ margin: 0; padding-left: 18px; color: var(--muted); }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: var(--text);
      display:inline-block;
      margin: 0 2px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <div class="left">
          <div class="brand">
            <div class="title">Fill-in-the-Blank</div>
            <div class="sub">Dark mode • Levels • Tutorial Help</div>
          </div>

          <div class="row tight" aria-label="Level controls">
            <label class="small" for="levelSelect">Level</label>
            <select id="levelSelect" title="Choose level">
              <!-- Add as many as you want -->
              <option value="A1">A1</option>
              <option value="A2">A2</option>
              <option value="B1">B1</option>
            </select>
          </div>
        </div>

        <div class="right">
          <button id="tutorialBtn" class="btn" title="Open tutorial (Help)">
            ❔ Tutorial
          </button>

          <!-- Change href to your hub location -->
          <a id="hubLink" class="btn ghost" href="../grammar-hub/index.html" title="Back to Grammar Hub">
            ⬅ Grammar Hub
          </a>
        </div>
      </div>

      <div class="content">
        <div class="grid">
          <div class="panel" aria-label="Question panel">
            <h2>Prompt</h2>

            <p class="sentence" id="sentence">
              Ich interessiere mich <span class="blank">_____</span> Mikroben.
            </p>

            <div class="row">
              <input id="answerInput" type="text" autocomplete="off" spellcheck="false"
                     placeholder="Type the missing word…" aria-label="Answer input" />
              <button id="checkBtn" class="btn primary">Check</button>
              <button id="hintBtn" class="btn">Hint</button>
              <button id="revealBtn" class="btn">Reveal</button>
            </div>

            <p class="hint" id="hintText" aria-live="polite"></p>

            <div id="feedback" class="feedback" style="display:none;" aria-live="polite"></div>
          </div>

          <div class="panel" aria-label="Progress panel">
            <h2>Progress</h2>

            <div class="row">
              <div class="pill">Question: <strong id="qNum">1</strong>/<strong id="qTotal">1</strong></div>
              <div class="pill">Score: <strong id="score">0</strong></div>
              <div class="pill">Streak: <strong id="streak">0</strong></div>
            </div>

            <div style="height:10px;"></div>

            <div class="row">
              <button id="nextBtn" class="btn good">Next</button>
              <button id="shuffleBtn" class="btn">Reshuffle</button>
              <button id="resetBtn" class="btn">Reset</button>
            </div>

            <div style="height:10px;"></div>
            <p class="hint">
              Tip: Press <span class="kbd">Enter</span> to check, <span class="kbd">H</span> for hint,
              <span class="kbd">N</span> for next, <span class="kbd">?</span> for tutorial.
            </p>
          </div>
        </div>
      </div>

      <div class="statusbar" aria-label="Status bar">
        <div class="pill">Level: <strong id="levelLabel">A1</strong></div>
        <div class="pill">Mode: <strong>Fill-in-the-Blank</strong></div>
        <div class="pill">Saved: <strong id="savedState">off</strong></div>
      </div>
    </div>
  </div>

  <!-- Tutorial Modal -->
  <div id="modalBackdrop" class="modalBackdrop" role="dialog" aria-modal="true" aria-labelledby="tutorialTitle">
    <div class="modal">
      <div class="modalHeader">
        <h3 id="tutorialTitle">Tutorial</h3>
        <button id="closeModalBtn" class="btn">✕ Close</button>
      </div>
      <div class="modalBody">
        <p>
          Goal: type the missing word(s) that correctly complete the sentence.
        </p>
        <ul>
          <li>Type your answer and press <span class="kbd">Enter</span> or click <span class="kbd">Check</span>.</li>
          <li>Use <span class="kbd">Hint</span> to get a clue (case/ending, preposition, etc.).</li>
          <li><span class="kbd">Reveal</span> shows the answer (no points for that item).</li>
          <li>Change <span class="kbd">Level</span> anytime to load a different set.</li>
          <li>Keyboard: <span class="kbd">H</span> hint • <span class="kbd">N</span> next • <span class="kbd">?</span> tutorial.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * 1) CONFIG: HUB LINK *
     ***********************/
    // If you want the hub link to be set dynamically:
    // document.getElementById("hubLink").href = "../grammar-hub/index.html";

    /**************************
     * 2) DATA: LEVEL CONTENT *
     **************************/
    // Each item can have: text, answer, hint, normalize(optional)
    const BANK = {
      A1: [
        {
          text: "Ich interessiere mich _____ Mikroben.",
          answer: "für",
          hint: "Preposition used with 'sich interessieren' → 'für' (+ Akk.)"
        },
        {
          text: "Er wartet _____ den Bus.",
          answer: "auf",
          hint: "Verb + preposition: 'warten auf' (+ Akk.)"
        }
      ],
      A2: [
        {
          text: "Worüber _____ ihr heute?",
          answer: "redet",
          hint: "Verb form: 'ihr' → 2nd person plural"
        },
        {
          text: "Sie ist stolz _____ ihre Arbeit.",
          answer: "auf",
          hint: "Adjective + preposition: 'stolz auf' (+ Akk.)"
        }
      ],
      B1: [
        {
          text: "Er hat sich daran gewöhnt, _____ früh aufzustehen.",
          answer: "so",
          hint: "Fixed expression: 'sich daran gewöhnen, so ...' (context-dependent)"
        },
        {
          text: "Das hängt davon ab, _____ du morgen Zeit hast.",
          answer: "ob",
          hint: "'davon ab, ob ...' introduces an indirect yes/no clause"
        }
      ]
    };

    /****************************
     * 3) STATE + UI REFERENCES *
     ****************************/
    const el = (id) => document.getElementById(id);

    const levelSelect = el("levelSelect");
    const levelLabel  = el("levelLabel");

    const sentenceEl  = el("sentence");
    const inputEl     = el("answerInput");
    const hintTextEl  = el("hintText");
    const feedbackEl  = el("feedback");

    const qNumEl   = el("qNum");
    const qTotalEl = el("qTotal");
    const scoreEl  = el("score");
    const streakEl = el("streak");

    const savedStateEl = el("savedState");

    const tutorialBtn = el("tutorialBtn");
    const modalBackdrop = el("modalBackdrop");
    const closeModalBtn = el("closeModalBtn");

    const checkBtn  = el("checkBtn");
    const hintBtn   = el("hintBtn");
    const revealBtn = el("revealBtn");
    const nextBtn   = el("nextBtn");
    const shuffleBtn = el("shuffleBtn");
    const resetBtn  = el("resetBtn");

    const STORAGE_KEY = "fill_blank_game_state_v1";

    const state = {
      level: levelSelect.value,
      deck: [],
      idx: 0,
      score: 0,
      streak: 0,
      usedHint: false,
      revealed: false,
      attempted: false,
      saved: false
    };

    /**********************
     * 4) HELPERS         *
     **********************/
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    function normalize(s){
      // default normalization: trim + collapse spaces + lowercase
      return (s ?? "")
        .trim()
        .replace(/\s+/g, " ")
        .toLowerCase();
    }

    function render(){
      const item = state.deck[state.idx];
      qTotalEl.textContent = state.deck.length;
      qNumEl.textContent   = state.deck.length ? (state.idx + 1) : 0;
      scoreEl.textContent  = state.score;
      streakEl.textContent = state.streak;
      levelLabel.textContent = state.level;

      // Display with a visible blank marker (purely visual)
      const display = item ? item.text.replace("_____", "<span class='blank'>_____</span>") : "No items in this level.";
      sentenceEl.innerHTML = display;

      inputEl.value = "";
      inputEl.focus();

      hintTextEl.textContent = "";
      feedbackEl.style.display = "none";
      feedbackEl.className = "feedback";
      state.usedHint = false;
      state.revealed = false;
      state.attempted = false;
    }

    function loadLevel(level){
      state.level = level;
      const raw = BANK[level] || [];
      state.deck = shuffle(raw);
      state.idx = 0;
      state.score = 0;
      state.streak = 0;
      state.saved = false;
      savedStateEl.textContent = "off";
      render();
    }

    function showFeedback(ok, message){
      feedbackEl.style.display = "block";
      feedbackEl.textContent = message;
      feedbackEl.className = "feedback " + (ok ? "good" : "bad");
    }

    function currentAnswer(){
      const item = state.deck[state.idx];
      return item ? String(item.answer) : "";
    }

    function openTutorial(){
      modalBackdrop.style.display = "flex";
      // basic focus management
      closeModalBtn.focus();
    }
    function closeTutorial(){
      modalBackdrop.style.display = "none";
      tutorialBtn.focus();
    }

    function saveState(){
      const payload = {
        level: state.level,
        idx: state.idx,
        score: state.score,
        streak: state.streak,
        deck: state.deck
      };
      try{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        state.saved = true;
        savedStateEl.textContent = "on";
      }catch(e){
        // ignore
      }
    }

    function tryRestoreState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return false;
        const payload = JSON.parse(raw);
        if(!payload || !payload.level || !Array.isArray(payload.deck)) return false;

        state.level = payload.level;
        levelSelect.value = payload.level;

        state.deck = payload.deck;
        state.idx = Math.min(payload.idx ?? 0, Math.max(0, state.deck.length - 1));
        state.score = payload.score ?? 0;
        state.streak = payload.streak ?? 0;

        state.saved = true;
        savedStateEl.textContent = "on";
        render();
        return true;
      }catch(e){
        return false;
      }
    }

    /**********************
     * 5) GAME ACTIONS    *
     **********************/
    function doHint(){
      const item = state.deck[state.idx];
      if(!item) return;
      if(state.usedHint){
        hintTextEl.textContent = "Hint already shown.";
        return;
      }
      state.usedHint = true;
      hintTextEl.textContent = "Hint: " + (item.hint || "No hint for this one.");
    }

    function doReveal(){
      const ans = currentAnswer();
      if(!ans) return;
      state.revealed = true;
      state.attempted = true;
      state.streak = 0;
      showFeedback(false, `Answer: "${ans}"`);
      saveState();
    }

    function doCheck(){
      const item = state.deck[state.idx];
      if(!item) return;

      const ans = currentAnswer();
      const user = inputEl.value;

      const normUser = (item.normalize ? item.normalize(user) : normalize(user));
      const normAns  = (item.normalize ? item.normalize(ans)  : normalize(ans));

      state.attempted = true;

      if(normUser === normAns){
        // scoring: 2 points if no hint, 1 point if hint, 0 if revealed
        const points = state.revealed ? 0 : (state.usedHint ? 1 : 2);
        state.score += points;
        state.streak += 1;
        showFeedback(true, points ? `Correct (+${points})` : "Correct");
        saveState();
      }else{
        state.streak = 0;
        showFeedback(false, `Not quite. Try again (or use Hint).`);
        saveState();
      }
    }

    function doNext(){
      if(!state.deck.length) return;
      if(state.idx < state.deck.length - 1){
        state.idx += 1;
      }else{
        // end of deck
        showFeedback(true, `Done! Final score: ${state.score}`);
        return;
      }
      saveState();
      render();
    }

    function doShuffle(){
      state.deck = shuffle(state.deck);
      state.idx = 0;
      saveState();
      render();
    }

    function doReset(){
      localStorage.removeItem(STORAGE_KEY);
      loadLevel(state.level);
    }

    /**********************
     * 6) EVENTS          *
     **********************/
    levelSelect.addEventListener("change", () => {
      loadLevel(levelSelect.value);
    });

    tutorialBtn.addEventListener("click", openTutorial);
    closeModalBtn.addEventListener("click", closeTutorial);
    modalBackdrop.addEventListener("click", (e) => {
      if(e.target === modalBackdrop) closeTutorial();
    });

    checkBtn.addEventListener("click", doCheck);
    hintBtn.addEventListener("click", doHint);
    revealBtn.addEventListener("click", doReveal);
    nextBtn.addEventListener("click", doNext);
    shuffleBtn.addEventListener("click", doShuffle);
    resetBtn.addEventListener("click", doReset);

    // Keyboard shortcuts
    document.addEventListener("keydown", (e) => {
      if(modalBackdrop.style.display === "flex"){
        if(e.key === "Escape") closeTutorial();
        return;
      }
      if(e.key === "Enter") doCheck();
      if(e.key.toLowerCase() === "h") doHint();
      if(e.key.toLowerCase() === "n") doNext();
      if(e.key === "?") openTutorial();
      if(e.key === "Escape"){
        // quick clear focus / message
        inputEl.blur();
      }
    });

    /**********************
     * 7) INIT            *
     **********************/
    (function init(){
      const restored = tryRestoreState();
      if(!restored) loadLevel(levelSelect.value);
    })();
  </script>
</body>
</html>

